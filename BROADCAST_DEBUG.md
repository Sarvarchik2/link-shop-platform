# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–Ø –¥–æ–±–∞–≤–∏–ª –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—Å—ã–ª–æ–∫, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "0 –∏–∑ 7 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ". –¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:

1. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏** - –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞
2. üë• **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π** - —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏  
3. üì§ **–ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏** - –¥–µ—Ç–∞–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é
4. ‚ùå **–û—à–∏–±–∫–∏ Telegram API** - –µ—Å–ª–∏ Telegram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
5. üìä **–ü—Ä–æ–≥—Ä–µ—Å—Å** - –∫–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ)

–†–∞—Å—Å—ã–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã–µ:
- –ù–∞—à–ª–∏ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
- –ù–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É `/start` –∏–ª–∏ "Start"

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ:
https://storely.up.railway.app/shop/sarvar/admin/broadcasts/debug/subscribers
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç —Å–∫–æ–ª—å–∫–æ —É –≤–∞—Å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.

### 2. –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram API

–ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –µ—Å—Ç—å, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –Ω–æ–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏.

### 3. –ó–∞–¥–∞—á–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

Celery –∏–ª–∏ BackgroundTasks –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `sarvar` –Ω–∞ –≤–∞—à shop_slug):
   ```
   https://link-shop-platform-production.up.railway.app/shop/sarvar/admin/broadcasts/debug/subscribers
   ```

2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø–æ–ª—è:
   - `total_subscribers` - –≤—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   - `recent_subscribers` - –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

### –®–∞–≥ 2: –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–µ—Ç - –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/start`
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
4. –°–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ endpoint –∏–∑ –®–∞–≥–∞ 1

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë
3. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í –ª–æ–≥–∞—Ö –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üöÄ Starting broadcast task for broadcast_id=X
‚úì Bot token decrypted for shop X
üìä Getting recipients with audience_type='all'
üë• Found X recipients for broadcast X
üì§ Sending message 1/X to chat_id=XXXXX
‚úÖ Broadcast X completed: X sent, X failed
```

### –®–∞–≥ 4: –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –ª–æ–≥-—Ñ–∞–π–ª –∏ —è –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è.

## –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

1. **`backend/app/features/broadcasts/tasks.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –§—É–Ω–∫—Ü–∏—è `send_telegram_message_callback` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö

2. **`backend/app/features/broadcasts/router.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω debug endpoint `/debug/subscribers` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω import datetime

## –¢–∏–ø–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: "0 –∏–∑ 7 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—à–ª–∞ 7 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user` –∏–ª–∏ `order`), –Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `UserStoreTelegram` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –∏—Ö `chat_id`.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/start`.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ debug endpoint
2. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–µ—Ç - –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ `/start`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É —Å–Ω–æ–≤–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
5. –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã - –ø–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ –ª–æ–≥–∏
